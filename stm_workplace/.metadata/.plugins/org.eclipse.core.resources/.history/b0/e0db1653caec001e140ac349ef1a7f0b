/*
 * pumpInterface.c
 *
 *  Created on: Mar 27, 2024
 *      Author: oneju
 */


#include "main.h"
#include "pumpInterface.h"
#include <string.h>

#define TRANSMIT_SIZE 	16
#define STX				0x02
#define NIBBLE_MERGE(MSN,LSN)	((MSN<<4)|(LSN))

uint8_t tx_command[TRANSMIT_SIZE];
uint8_t ad1 = 0;
uint8_t ad2 = 0;
uint8_t ad3 = 0;
uint8_t ad4 = 0;
uint8_t ad5 = 0;
uint8_t ad6 = 0;
uint8_t ad7 = 0b1001;	// 9h
uint8_t ad8 = 0b1110;	// E

void accessPumpData(UART_HandleTypeDef* huart){
	 // Initialize tx_command with STX at index 0
	tx_command[0] = STX;

    // Assign 'M', '2', '0' at indices 1, 2, 3 using memcpy
    memcpy(&tx_command[1], "M20", 3);

    tx_command[4] = NIBBLE_MERGE(ad1,ad2);
    tx_command[5] = NIBBLE_MERGE(ad3,ad4);
    tx_command[6] = NIBBLE_MERGE(ad5,ad6);
    tx_command[7] = NIBBLE_MERGE(ad7,ad8);

    memcpy(&tx_command[8], 0, 4);

	HAL_UART_Transmit(huart, &tx_command[0], TRANSMIT_SIZE, HAL_MAX_DELAY);
	return;
}
